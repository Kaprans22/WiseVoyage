<br>
<br>
<br>
<%# app/views/trips/show.html.erb %>
<div class="container">
  <div>
    <h1><%= @trip.destination %>âœ¨</h1>
  </div>
  <br>
  <div class="d-flex justify-content-between">
    <div class="dates">
      <p>Start date: <%= @trip.start_date %></p>
      <p>End date: <%= @trip.end_date %></p>
    </div>

    <%= render "user_trips/new"  %>
  </div>
  <div class="show-gallery">
    <div class="images-show-big">
      <%= image_tag @trip.image_urls[0] if @trip.image_urls[0] %>
    </div>
    <div class="images-show-small">
      <% @trip.image_urls.drop(1).each do |url| %>
        <div class="smaller-images-show">
          <%= image_tag url if url %>
        </div>
      <% end %>
    </div>
  </div>
  <br>
  <br>

  <!-- Short description -->
  <h5><i class="fa-solid fa-quote-left" style="color: #e95653;"></i></h5>
  <h5><%= @trip.content.split("=>").last[1..-3] %></h5>
  <br>

  <!-- Itinerary -->
  <h2>Additional Suggestions:</h2>
  <% suggestions = JSON.parse(@trip.additional_suggestions) %>
  <% suggestions.each do |suggestion| %>
    <div class="suggestion-card">
      <button class="collapsible w-100">
        <div class="text-left"><%= suggestion["date"]%></div>
        <span class="ml-4"></span>
      </button>
      <div class="collapsible-content">
        <% suggestion["suggestions"].each do |sug|%>
          <p><%= sug %></p>
        <% end %>
      </div>
    </div>
  <% end %>
  <br>
  <%= form_with url: { action: "calculate_average", id: @trip.id }, method: :get do %>
    <%= text_field_tag :city_name, nil, placeholder: "Enter city name" %>
    <%= submit_tag 'Calculate Average Cost' %>
  <% end %>
  <br>
  <h2>Calculated Average</h2>
  <p>The average cost for the trip to <%= @trip.destination %> is <%= @trip.average_cost %></p>
  <%= button_to 'Back', trips_path, class: "btn btn-outline-black", method: :get %>
</div>

<!-- Collapsible script -->
<script>
  let coll = document.getElementsByClassName("collapsible");

  for (let i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      let content = this.nextElementSibling;
      if (content.style.maxHeight){
        content.style.maxHeight = null;
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
      }
    });
  }
</script>
